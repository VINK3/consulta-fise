<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Consulta Estado FISE</title>
    <style>
        /* Reset básico */
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #003366;
            background: url('electrocentro.jpg') no-repeat center center fixed;
            background-size: contain;
            margin: 0;
            padding: 0;
            color: white;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        header {
            background-color: #004080cc;
            padding: 15px 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        header img {
            height: 60px;
            max-width: 150px;
            object-fit: contain;
        }
        main.container {
            background-color: rgba(0, 0, 0, 0.7);
            margin: 30px auto 40px;
            padding: 20px 20px 30px;
            border-radius: 12px;
            width: 95%;
            max-width: 600px;
            box-shadow: 0 0 15px 3px #004080cc;
        }
        main.container h1 {
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        input[type="text"] {
            width: 100%;
            max-width: 400px;
            padding: 12px 15px;
            font-size: 1.1rem;
            border-radius: 8px;
            border: none;
            margin-bottom: 10px;
            outline: none;
        }
        button {
            width: 100%;
            max-width: 400px;
            background-color: #007a33;
            border: none;
            padding: 12px;
            font-size: 1.1rem;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:disabled {
            background-color: #004d1a;
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            background-color: #00994d;
        }
        #loading {
            margin-top: 15px;
            font-style: italic;
            display: none;
        }
        #mensaje {
            margin-top: 12px;
            color: #ff5555;
            font-weight: bold;
            min-height: 1.2em;
        }
        table {
            margin: 25px auto 0;
            width: 100%;
            max-width: 600px;
            border-collapse: collapse;
            box-shadow: 0 0 10px 2px #004080bb;
        }
        th, td {
            padding: 12px 10px;
            border: 1px solid white;
            text-align: center;
            font-size: 1rem;
        }
        th {
            background-color: #004080;
        }
        @media (max-width: 480px) {
            header {
                gap: 15px;
            }
            header img {
                height: 45px;
                max-width: 120px;
            }
            main.container h1 {
                font-size: 1.5rem;
            }
            input[type="text"], button {
                max-width: 100%;
                font-size: 1rem;
                padding: 10px;
            }
            th, td {
                padding: 8px 5px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <img src="logo_fise.png" alt="Logo FISE" title="FISE - Fondo de Inclusión Social Energético" />
        <img src="electrocentro.png" alt="Logo Electrocentro" title="Electrocentro" />
    </header>

    <main class="container">
        <h1>Consulta Estado FISE</h1>
        <input type="text" id="dniInput" placeholder="Ingrese su DNI (8 dígitos)" maxlength="8" aria-label="Ingresar DNI" />
        <button id="btnBuscar" onclick="buscar()">Consultar</button>
        <div id="loading">Buscando...</div>
        <div id="mensaje" role="alert" aria-live="assertive"></div>

        <table id="resultado" style="display:none;" aria-describedby="mensaje">
            <thead>
                <tr>
                    <th>DNI</th>
                    <th>TIPO DE BENEFICIARIO</th>
                    <th>ESTADO FISE</th>
                    <th>OBSERVACIÓN</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </main>

    <script>
        const urlDatos = "https://docs.google.com/spreadsheets/d/1uVVJ2H0AfM08gxz15OJXRwQupMrWLJQH/gviz/tq?tqx=out:json";

        let datos = [];

        async function cargarDatos() {
            try {
                const res = await fetch(urlDatos);
                const text = await res.text();
                const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));

                const cols = json.table.cols.map(c => c.label.toLowerCase());
                datos = json.table.rows.map(row => {
                    let obj = {};
                    row.c.forEach((cell, i) => {
                        obj[cols[i]] = cell ? cell.v.toString().trim() : "";
                    });
                    return obj;
                });
                console.log("Datos cargados", datos);
                document.getElementById('mensaje').textContent = "";
            } catch (error) {
                document.getElementById('mensaje').textContent = "Error cargando base de datos. Por favor, intente más tarde.";
                console.error(error);
            }
        }

        function validarDNI(dni) {
            return /^\d{8}$/.test(dni);
        }

        function buscar() {
            const dni = document.getElementById("dniInput").value.trim();
            const resultado = document.getElementById("resultado");
            const cuerpo = document.getElementById("resultBody");
            const loading = document.getElementById("loading");
            const mensaje = document.getElementById("mensaje");
            const btnBuscar = document.getElementById("btnBuscar");

            resultado.style.display = "none";
            cuerpo.innerHTML = "";
            mensaje.textContent = "";

            if (!validarDNI(dni)) {
                mensaje.textContent = "Por favor ingrese un DNI válido de 8 dígitos.";
                return;
            }
            if (datos.length === 0) {
                mensaje.textContent = "La base de datos aún no está cargada. Intente nuevamente en unos segundos.";
                return;
            }

            loading.style.display = "block";
            btnBuscar.disabled = true;

            setTimeout(() => {
                const encontrado = datos.find(d => d.dni === dni);

                if (encontrado) {
                    cuerpo.innerHTML = `
                        <tr>
                            <td>${encontrado.dni}</td>
                            <td>${encontrado.tipo}</td>
                            <td>${encontrado.estado}</td>
                            <td>${encontrado.observacion}</td>
                        </tr>
                    `;
                } else {
                    cuerpo.innerHTML = `<tr><td colspan="4">No se encontraron resultados.</td></tr>`;
                }

                resultado.style.display = "table";
                loading.style.display = "none";
                btnBuscar.disabled = false;
            }, 800);
        }

        document.getElementById("dniInput").addEventListener("keypress", e => {
            if (e.key === "Enter") buscar();
        });

        cargarDatos();
    </script>
</body>
</html>
